<div class="mat-title pxb-auth-title">{{ getTitle() }}</div>

<!-- Error State -->
<ng-container *ngIf="(!isValidRegistrationLink || hasEulaLoadError) && !isLoading">
    <div class="pxb-create-account-invite-content-error-state">
        <!-- TODO: How should we handle error states? -->
        <pxb-empty-state title="Error" description="There was an error during account registration.">
            <mat-icon pxb-empty-icon>error</mat-icon>
        </pxb-empty-state>
    </div>
    <mat-divider class="pxb-auth-divider" style="margin-bottom: 16px;"></mat-divider>
    <div class="pxb-auth-action-button-container">
        <button mat-flat-button color="primary" (click)="navigateToLogin()" [style.width.%]="100">Okay</button>
    </div>
</ng-container>

<ng-container *ngIf="isValidRegistrationLink && !hasEulaLoadError && !isLoading">
    <div class="pxb-create-account-invite-content" *ngIf="currentPageId === 0">
        <div *ngIf="licenseAgreement" class="pxb-create-account-invite-license-agreement">{{ licenseAgreement }}</div>
        <div class="pxb-create-account-invite-confirm-agreement">
            <mat-checkbox
                class="pxb-create-account-invite-checkbox"
                [disabled]="!licenseAgreement"
                [(ngModel)]="confirmAgreement"
                ngDefaultControl
                >I have read and agree to the Terms & Conditions</mat-checkbox
            >
        </div>
    </div>

    <div class="pxb-create-account-invite-content" *ngIf="currentPageId === 1">
        <p class="mat-body-1" style="margin-bottom: 24px;">
            Please select a password. Make sure that your password meets the necessary complexity requirements outlined
            below.
        </p>
        <mat-divider class="pxb-auth-divider" style="margin-top: 16px; margin-bottom: 32px;"></mat-divider>
        <div>
            <form [formGroup]="passwordFormGroup">
                <mat-form-field appearance="fill" style="width: 100%;">
                    <mat-label>Password</mat-label>
                    <input
                        id="password"
                        name="password"
                        matInput
                        placeholder="Password"
                        required
                        formControlName="newPassword"
                        [type]="newPasswordVisible ? 'text' : 'password'"
                        (keyup)="checkPasswordStrength($event.target.value)"
                    />
                    <button mat-icon-button matSuffix (click)="toggleNewPasswordVisibility()">
                        <mat-icon>{{ newPasswordVisible ? 'visibility' : 'visibility_off' }}</mat-icon>
                    </button>
                </mat-form-field>
                <mat-list class="pxb-create-account-invite-validation-list">
                    <app-password-strength-check [success]="passLength" validationMessage="8-16 Characters">
                    </app-password-strength-check>
                    <app-password-strength-check [success]="numberFlag" validationMessage="One number">
                    </app-password-strength-check>
                    <app-password-strength-check [success]="upperFlag" validationMessage="One uppercase letter">
                    </app-password-strength-check>
                    <app-password-strength-check [success]="lowerFlag" validationMessage="One lowercase letter">
                    </app-password-strength-check>
                    <app-password-strength-check [success]="specialFlag" validationMessage="One special character">
                    </app-password-strength-check>
                </mat-list>
                <mat-form-field appearance="fill" style="width: 100%;">
                    <mat-label>Confirm Password</mat-label>
                    <input
                        id="confirm"
                        name="confirm"
                        matInput
                        placeholder="Confirm Password"
                        required
                        formControlName="confirmPassword"
                        [type]="confirmPasswordVisible ? 'text' : 'password'"
                        (focus)="confirmPasswordFocused = true"
                        (blur)="confirmPasswordFocused = false"
                        [errorStateMatcher]="errorMatcher"
                    />
                    <button mat-icon-button matSuffix (click)="toggleConfirmPasswordVisibility()">
                        <mat-icon>{{ confirmPasswordVisible ? 'visibility' : 'visibility_off' }}</mat-icon>
                    </button>
                    <mat-error *ngIf="!confirmPasswordFocused && passwordFormGroup.hasError('passwordsDoNotMatch')"
                        >Passwords do not match
                    </mat-error>
                </mat-form-field>
            </form>
        </div>
    </div>

    <div class="pxb-create-account-invite-content" *ngIf="currentPageId === 2">
        <p class="mat-body-1" style="margin-bottom: 24px;">Enter your details below to complete account creation.</p>
        <mat-divider class="pxb-auth-divider" style="margin-top: 16px; margin-bottom: 32px;"></mat-divider>
        <form>
            <mat-form-field appearance="fill" style="width: 100%;" class="pxb-create-account-invite-form-field">
                <mat-label>First Name</mat-label>
                <input id="first" name="first" matInput [formControl]="firstNameFormControl" />
                <mat-error *ngIf="firstNameFormControl.hasError('required')">
                    First Name is <strong>required</strong>
                </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" style="width: 100%;" class="pxb-create-account-invite-form-field">
                <mat-label>Last Name</mat-label>
                <input id="last" name="last" matInput [formControl]="lastNameFormControl" />
                <mat-error *ngIf="lastNameFormControl.hasError('required')">
                    Last Name is <strong>required</strong>
                </mat-error>
            </mat-form-field>
            <mat-form-field appearance="fill" style="width: 100%;" class="pxb-create-account-invite-form-field">
                <mat-label>Phone Number (optional)</mat-label>
                <input id="phone" name="phone" matInput [formControl]="phoneNumberFormControl" />
            </mat-form-field>
        </form>
    </div>

    <div class="pxb-create-account-invite-content" *ngIf="currentPageId === 3" style="justify-content: center;">
        <pxb-empty-state
            class="pxb-create-account-invite-success"
            [title]="getSuccessEmptyStateTitle()"
            [description]="getSuccessEmptyStateDescription()"
        >
            <mat-icon pxb-empty-icon class="pxb-create-account-invite-empty-state-icon">check_circle</mat-icon>
        </pxb-empty-state>
    </div>

    <mat-divider class="pxb-auth-divider" style="margin-bottom: 16px;"></mat-divider>
    <div class="pxb-auth-action-button-container">
        <button *ngIf="currentPageId !== 3" mat-stroked-button color="primary" (click)="goBack()" style="width: 100px;">
            Back
        </button>
        <pxb-dot-stepper
            *ngIf="currentPageId <= 2"
            [steps]="pageCount"
            [activeStepId]="currentPageId"
        ></pxb-dot-stepper>
        <button
            *ngIf="currentPageId <= 1"
            mat-flat-button
            color="primary"
            [disabled]="canContinue()"
            (click)="next()"
            style="width: 100px;"
        >
            Next
        </button>
        <button
            *ngIf="currentPageId === 2"
            mat-flat-button
            color="primary"
            [disabled]="canContinue()"
            (click)="registerAccount()"
            style="width: 100px"
        >
            Next
        </button>
        <button
            *ngIf="currentPageId === 3"
            mat-flat-button
            color="primary"
            (click)="navigateToLogin()"
            style="width: 100%"
        >
            Continue
        </button>
    </div>
</ng-container>
